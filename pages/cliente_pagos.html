<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pagos y Facturas | BOXROOMER</title>

    <!-- Icons & Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
        rel="stylesheet">
    <link href="../assets/css/style.css" rel="stylesheet">
    <link href="../assets/css/chat.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../assets/js/tailwind.config.js"></script>
    <script src="../assets/js/theme-engine.js"></script>
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="../assets/js/pdf_system.js?v=8"></script>

    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* Chat Widget Position Fix for Mobile */
        @media (max-width: 768px) {
            #boxbot-widget {
                bottom: 120px !important;
                right: 1.5rem !important;
            }
        }
    </style>
</head>

<body
    class="min-h-screen relative overflow-x-hidden bg-[var(--app-bg)] text-[var(--text-main)] transition-colors duration-300">

    <!-- Background Decor -->
    <div
        class="fixed -top-40 -left-40 w-[600px] h-[600px] bg-brandPurple/10 rounded-full blur-[120px] pointer-events-none opacity-50">
    </div>
    <div
        class="fixed -bottom-40 -right-40 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[100px] pointer-events-none opacity-30">
    </div>

    <div class="md:flex min-h-screen relative z-10">

        <!-- Desktop Sidebar -->
        <aside
            class="hidden md:flex fixed top-0 left-0 h-screen w-72 bg-[var(--sidebar-bg)] backdrop-blur-3xl border-r border-[var(--card-border)] flex-col p-8 z-50 justify-between transition-colors duration-300">
            <div>
                <div class="flex items-center gap-3 mb-12 cursor-pointer group"
                    onclick="window.location.href='../index.html'">
                    <img src="../assets/images/logo.png" alt="PLUSER"
                        class="h-8 md:h-10 w-auto group-hover:scale-105 transition-transform">
                </div>

                <nav class="space-y-3 nav-relative sidebar-nav-pill">
                    <div class="nav-indicator-sidebar"></div>
                    <a href="cliente_dashboard.html"
                        class="flex items-center gap-4 px-5 py-4 rounded-2xl text-[var(--text-muted)] hover:text-[var(--text-main)] transition-all group">
                        <span class="material-symbols-outlined">home</span>
                        <span class="font-black text-[11px] uppercase tracking-widest">Inicio</span>
                    </a>
                    <a href="cliente_inventario.html"
                        class="flex items-center gap-4 px-5 py-4 rounded-2xl text-[var(--text-muted)] hover:text-[var(--text-main)] transition-all group">
                        <span class="material-symbols-outlined">inventory_2</span>
                        <span class="font-black text-[11px] uppercase tracking-widest">Mi Espacio</span>
                    </a>
                    <a href="cliente_pagos.html"
                        class="nav-item-pill-active flex items-center gap-4 px-5 py-4 rounded-2xl transition-all group">
                        <span class="material-symbols-outlined filled">receipt_long</span>
                        <span class="font-black text-[11px] uppercase tracking-widest">Pagos</span>
                    </a>
                    <a href="cliente_cuenta.html"
                        class="flex items-center gap-4 px-5 py-4 rounded-2xl text-[var(--text-muted)] hover:text-[var(--text-main)] transition-all group">
                        <span class="material-symbols-outlined">settings</span>
                        <span class="font-black text-[11px] uppercase tracking-widest">Cuenta</span>
                    </a>
                </nav>

                <!-- Theme Toggle Button -->
                <button onclick="ThemeEngine.toggle()"
                    class="mt-6 w-full flex items-center justify-between px-5 py-4 rounded-2xl bg-[var(--icon-bg)] border border-[var(--card-border)] text-[var(--text-main)] hover:bg-[var(--card-hover)] transition-all group">
                    <span class="font-black text-[10px] uppercase tracking-widest">Modo Visual</span>
                    <span class="material-symbols-outlined theme-toggle-icon text-brandPurple">dark_mode</span>
                </button>

                <!-- Action Button -->
                <button onclick="window.location.href='../pages/reserva.html?from=pagos'"
                    class="mt-10 w-full group relative bg-brandPurple text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] shadow-xl hover:shadow-brandPurple/20 hover:scale-[1.02] transition-all flex items-center justify-center gap-3 overflow-hidden">
                    <span class="material-symbols-outlined text-lg">add_circle</span> Guardar Más
                </button>
            </div>

            <div class="flex items-center gap-4 p-4 rounded-2xl border border-[var(--card-border)] bg-[var(--card-bg)] cursor-pointer hover:bg-[var(--card-hover)] transition-all group"
                onclick="window.location.href='../index.html'">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-brandPurple/20 to-brandPurple/40 text-brandPurple flex items-center justify-center font-black border border-brandPurple/20">
                    IM</div>
                <div class="flex-1">
                    <p
                        class="text-xs font-black text-[var(--text-main)] group-hover:text-brandPurple transition-colors">
                        Israel
                        Madrigal</p>
                    <p class="text-[9px] text-[var(--text-muted)] font-bold uppercase tracking-wider">Cerrar Sesión</p>
                </div>
                <span
                    class="material-symbols-outlined text-[var(--text-muted)] text-lg group-hover:text-red-400 group-hover:translate-x-1 transition-all">logout</span>
            </div>
        </aside>

        <!-- Main Content Wrapper -->
        <div class="flex-1 flex flex-col md:ml-72 transition-all duration-300">

            <!-- Top Mobile Bar (Logo & Profile only) -->
            <nav
                class="md:hidden sticky top-0 z-40 bg-[var(--app-bg)] backdrop-blur-xl border-b border-[var(--card-border)] px-6 py-4 flex justify-between items-center transition-colors">
                <div class="flex items-center gap-2">
                    <img src="../assets/images/logo.png" alt="PLUSER" class="h-6 w-auto">
                </div>
                <div
                    class="w-9 h-9 rounded-full bg-brandPurple/20 text-brandPurple flex items-center justify-center font-bold border border-brandPurple/30">
                    IM
                </div>
            </nav>

            <main class="px-5 pt-8 pb-32 max-w-lg mx-auto md:max-w-7xl md:mx-0 md:p-12 w-full fade-in-section">

                <!-- Header -->
                <div class="mb-10">
                    <h1
                        class="text-3xl md:text-5xl font-black text-[var(--text-main)] tracking-tighter italic uppercase leading-none">
                        Tu Wallet <span class="text-brandPurple underline decoration-brandPurple/20">Box</span>
                    </h1>
                    <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.3em] mt-4">Gestión financiera
                        y facturación</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                    <!-- Left: Current Plan Details -->
                    <div
                        class="group relative bg-[var(--card-bg)] border border-[var(--card-border)] rounded-[2.5rem] p-6 overflow-hidden shadow-2xl transition-all duration-500 hover:border-brandPurple/30 flex flex-col h-full">
                        <div
                            class="absolute -left-20 -top-20 w-60 h-60 bg-brandPurple/5 rounded-full blur-[80px] pointer-events-none group-hover:bg-brandPurple/10 transition-all duration-700">
                        </div>

                        <div class="relative z-10 flex justify-between items-start mb-6 min-h-[90px]">
                            <div>
                                <span class="text-[9px] font-black uppercase tracking-[0.3em] text-brandPurple pl-1">Tu
                                    suscripción activa</span>
                                <h2 id="plan-name"
                                    class="text-2xl font-black text-[var(--text-main)] italic uppercase tracking-tighter mt-2 leading-none">
                                    Pack Standard</h2>
                            </div>
                            <div class="text-right">
                                <span id="plan-duration"
                                    class="inline-block px-3 py-1 bg-brandPurple text-white text-[8px] font-black rounded-full uppercase tracking-widest shadow-lg shadow-brandPurple/20">--
                                    Meses</span>
                                <div class="mt-4 space-y-1">
                                    <p id="plan-start-date"
                                        class="text-[9px] font-bold text-slate-500 uppercase tracking-widest opacity-60">
                                        Desde --</p>
                                    <p id="planExpiryDate"
                                        class="text-[9px] font-bold uppercase tracking-widest transition-colors duration-300">
                                        Hasta --</p>
                                </div>
                            </div>
                        </div>

                        <div class="relative z-10 mb-6">
                            <span
                                class="text-[9px] font-black uppercase tracking-[0.3em] text-[var(--text-muted)] pl-1">Espacio
                                Reservado</span>
                            <p class="text-3xl font-black text-[var(--text-main)] mt-1"><span
                                    id="plan-volume">0.0</span> <span
                                    class="text-brandPurple text-xl italic uppercase">m³</span></p>
                        </div>

                        <!-- Active Services List (Dynamic) -->
                        <div id="active-services-list" class="relative z-10 space-y-2 hidden">
                            <!-- Items will be injected here -->
                        </div>
                    </div>

                    <!-- Right: Next Payment Card -->
                    <div
                        class="group relative bg-[var(--card-bg)] border border-[var(--card-border)] rounded-[2.5rem] p-6 overflow-hidden shadow-2xl transition-all duration-500 hover:border-brandPurple/30 flex flex-col h-full">
                        <div
                            class="absolute -right-20 -bottom-20 w-60 h-60 bg-brandPurple/10 rounded-full blur-[80px] pointer-events-none group-hover:bg-brandPurple/20 transition-all duration-700">
                        </div>

                        <div class="relative z-10 flex justify-between items-start mb-6 min-h-[90px]">
                            <div>
                                <span
                                    class="text-[9px] font-black uppercase tracking-[0.3em] text-[var(--text-muted)] pl-1">Próximo
                                    Cargo</span>
                                <h2 id="next-charge-date"
                                    class="text-2xl font-black text-[var(--text-main)] italic uppercase tracking-tighter mt-2 leading-none">
                                    --</h2>
                            </div>
                            <div
                                class="w-12 h-12 rounded-2xl bg-[var(--icon-bg)] flex items-center justify-center border border-[var(--card-border)] group-hover:bg-brandPurple/20 group-hover:border-brandPurple/30 transition-all">
                                <span
                                    class="material-symbols-outlined text-[var(--text-main)] text-xl">calendar_today</span>
                            </div>
                        </div>

                        <div class="relative z-10 mb-6">
                            <div>
                                <span
                                    class="text-[9px] font-black uppercase tracking-[0.3em] text-[var(--text-muted)] pl-1">Cuota
                                    Mensual</span>
                                <p class="text-3xl font-black text-[var(--text-main)] mt-1"><span
                                        id="monthly-fee">0,00</span> <span
                                        class="text-brandPurple text-xl italic uppercase">€</span></p>
                            </div>
                        </div>

                        <button onclick="openAdvancePaymentModal()"
                            class="mt-auto w-full relative group/btn bg-[var(--icon-bg)] hover:bg-white/[0.05] py-4 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] text-[var(--text-main)] transition-all overflow-hidden border border-[var(--card-border)] hover:border-brandPurple/40 shadow-xl">
                            Adelantar Pago
                        </button>
                    </div>
                </div>


                <div class="grid grid-cols-1 lg:grid-cols-12 gap-y-20 lg:gap-12">
                    <!-- Left: Payment Methods -->
                    <div class="lg:col-span-4 lg:sticky lg:top-8 self-start">
                        <div class="flex justify-between items-center mb-6 px-1">
                            <h3
                                class="text-[10px] font-black text-[var(--text-muted)] uppercase tracking-widest leading-none">
                                Tus Tarjetas</h3>
                            <button onclick="openManagePaymentModal()"
                                class="text-brandPurple text-[10px] font-black uppercase tracking-widest hover:scale-105 transition-all">Configurar</button>
                        </div>

                        <div id="payment-methods-empty"
                            class="text-center py-6 border border-dashed border-[var(--card-border)] rounded-2xl bg-[var(--card-bg)] opacity-60">
                            <span
                                class="material-symbols-outlined text-3xl mb-2 text-[var(--text-muted)]">credit_card_off</span>
                            <p class="text-[9px] font-black uppercase tracking-widest text-[var(--text-muted)]">No hay
                                tarjetas guardadas</p>
                        </div>
                        <div id="savedCardsList"></div>
                    </div>

                    <!-- Col 2: Invoices List -->
                    <div class="lg:col-span-8 mt-12 lg:mt-0">
                        <div class="flex items-center gap-3 mb-8 pl-1">
                            <h3
                                class="text-[10px] font-black text-[var(--text-muted)] uppercase tracking-widest leading-none">
                                Actividad de Facturación</h3>
                            <div class="flex-1 h-px bg-[var(--card-border)]"></div>
                        </div>

                        <div id="invoices-list-container" class="space-y-4 text-center py-10">
                            <span
                                class="material-symbols-outlined text-4xl text-[var(--text-muted)] opacity-30 animate-pulse">receipt_long</span>
                            <p class="text-xs text-[var(--text-muted)] uppercase tracking-widest font-black mt-4">
                                Cargando Facturación...</p>
                        </div>
                    </div>

                </div>

            </main>
        </div>
    </div>



    <!-- Modal: Renovación de Plan -->
    <div id="renewalModal"
        class="hidden fixed inset-0 bg-[#0A0510]/95 backdrop-blur-2xl z-[150] flex items-center justify-center p-4 md:p-6 overflow-y-auto">
        <div
            class="bg-[var(--app-bg)] border border-[var(--card-border)] rounded-[3rem] p-8 md:p-12 max-w-2xl w-full shadow-2xl relative my-auto">
            <div
                class="absolute -right-20 -top-20 w-60 h-60 bg-brandPurple/10 rounded-full blur-[100px] pointer-events-none">
            </div>

            <div class="flex justify-between items-start mb-10 relative z-10">
                <div>
                    <h3
                        class="text-3xl font-black text-[var(--text-main)] italic tracking-tighter uppercase leading-none">
                        Gestionar <span class="text-brandPurple">Plan</span></h3>
                    <p class="text-[10px] font-black text-[var(--text-muted)] uppercase tracking-widest mt-4">Optimiza
                        tu espacio y ahorra con BoxBot IA</p>
                </div>
                <button onclick="closeRenewalModal()"
                    class="w-10 h-10 bg-[var(--icon-bg)] border border-[var(--card-border)] rounded-2xl flex items-center justify-center hover:bg-brandPurple hover:text-white transition-all">
                    <span class="material-symbols-outlined text-lg">close</span>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 relative z-10">
                <!-- Monthly Plan -->
                <div onclick="selectRenewalPlan('monthly', event)"
                    class="plan-card group bg-[var(--icon-bg)] border-2 border-transparent p-6 rounded-[2rem] cursor-pointer hover:bg-[var(--card-bg)] hover:border-brandPurple/20 transition-all text-center">
                    <p class="text-[9px] font-black text-[var(--text-muted)] uppercase tracking-widest mb-4">Mes a Mes
                    </p>
                    <div id="price-monthly" class="text-2xl font-black text-[var(--text-main)] mb-1">--€</div>
                    <p class="text-[8px] font-bold text-slate-500 uppercase tracking-widest">Pago Flexible</p>
                </div>

                <!-- 6 Months Plan -->
                <div onclick="selectRenewalPlan('6months', event)"
                    class="plan-card group bg-[var(--icon-bg)] border-2 border-transparent p-6 rounded-[2rem] cursor-pointer hover:bg-[var(--card-bg)] hover:border-brandPurple/20 transition-all text-center relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 bg-brandPurple text-white text-[7px] font-black px-3 py-1 rounded-bl-xl uppercase tracking-widest">
                        -10%</div>
                    <p class="text-[9px] font-black text-[var(--text-muted)] uppercase tracking-widest mb-4">6 Meses</p>
                    <div id="price-6months" class="text-2xl font-black text-[var(--text-main)] mb-1">--€</div>
                    <p class="text-[8px] font-bold text-slate-500 uppercase tracking-widest">Ahorro Semestral</p>
                </div>

                <!-- 12 Months Plan -->
                <div onclick="selectRenewalPlan('12months', event)"
                    class="plan-card active-plan group bg-brandPurple/5 border-2 border-brandPurple p-6 rounded-[2rem] cursor-pointer hover:bg-brandPurple/10 transition-all text-center relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 bg-green-500 text-white text-[7px] font-black px-3 py-1 rounded-bl-xl uppercase tracking-widest">
                        -20%</div>
                    <p class="text-[9px] font-black text-brandPurple uppercase tracking-widest mb-4">12 Meses</p>
                    <div id="price-12months" class="text-2xl font-black text-[var(--text-main)] mb-1">--€</div>
                    <p class="text-[8px] font-bold text-brandPurple/60 uppercase tracking-widest">Máximo Valor</p>
                </div>
            </div>

            <div class="bg-[var(--icon-bg)] border border-[var(--card-border)] rounded-3xl p-8 mb-10 relative z-10">
                <div class="flex items-center gap-4 mb-6">
                    <div
                        class="w-10 h-10 rounded-xl bg-brandPurple/10 flex items-center justify-center border border-brandPurple/20">
                        <span class="material-symbols-outlined text-brandPurple">view_in_ar</span>
                    </div>
                    <div>
                        <p class="text-[9px] font-black text-[var(--text-muted)] uppercase tracking-widest">Base de
                            Cálculo</p>
                        <p class="text-sm font-black text-[var(--text-main)] uppercase tracking-tighter">Tu espacio
                            actual consolidado: <span id="modal-volume-base">--</span> m³</p>
                    </div>
                </div>

                <label
                    class="flex items-center gap-4 cursor-pointer p-4 rounded-2xl bg-[var(--card-bg)] border border-[var(--card-border)] hover:border-brandPurple/30 transition-all">
                    <div
                        class="relative w-12 h-6 bg-slate-200 dark:bg-slate-800 rounded-full transition-colors flex items-center px-1">
                        <input type="checkbox" id="autoRenewCheck" class="sr-only peer" checked>
                        <div
                            class="w-4 h-4 bg-white rounded-full shadow-md transition-transform peer-checked:translate-x-6 peer-checked:bg-brandPurple">
                        </div>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-[var(--text-main)] uppercase tracking-widest">Renovación
                            Automática</p>
                        <p class="text-[8px] font-bold text-[var(--text-muted)] uppercase tracking-widest mt-1">Evita
                            costes adicionales por bultos extras</p>
                    </div>
                </label>
            </div>

            <div class="flex flex-col md:flex-row gap-4 relative z-10">
                <button onclick="closeRenewalModal()"
                    class="flex-1 py-5 bg-[var(--icon-bg)] text-[var(--text-muted)] rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] hover:bg-white/[0.05] transition-all">Más
                    tarde</button>
                <button onclick="confirmRenewal()"
                    class="flex-[2] py-5 bg-brandPurple text-white rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] shadow-2xl shadow-brandPurple/30 hover:scale-[1.02] transition-all flex items-center justify-center gap-3">
                    Confirmar Selección <span class="material-symbols-outlined text-sm">check_circle</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Adelantar Pago -->

    <div id="advancePaymentModal"
        class="hidden fixed inset-0 bg-[#0A0510]/80 backdrop-blur-xl z-[100] flex items-center justify-center p-6">
        <div
            class="bg-[var(--app-bg)] border border-[var(--card-border)] rounded-[3rem] p-10 max-w-md w-full shadow-2xl relative overflow-hidden">
            <div class="absolute -right-20 -top-20 w-40 h-40 bg-brandPurple/10 rounded-full blur-[80px]"></div>

            <h3
                class="text-3xl font-black text-[var(--text-main)] italic tracking-tighter uppercase mb-2 relative z-10">
                Adelantar
                Pago</h3>
            <p class="text-[10px] font-black text-[var(--text-muted)] uppercase tracking-widest mb-10 relative z-10">
                Confirma la
                liquidación anticipada</p>

            <div class="bg-[var(--icon-bg)] border border-[var(--card-border)] rounded-3xl p-8 mb-10 relative z-10">
                <div class="flex justify-between items-end mb-6">
                    <span class="text-[9px] font-black text-[var(--text-muted)] uppercase tracking-[0.2em]">Total
                        Transacción</span>
                    <span id="advance-total-amount" class="text-3xl font-black text-[var(--text-main)]">--€</span>
                </div>
                <div class="flex justify-between items-center pt-6 border-t border-[var(--card-border)]">
                    <span
                        class="text-[9px] font-black text-[var(--text-muted)] uppercase tracking-[0.2em]">Fuente</span>
                    <div class="flex items-center gap-2">
                        <span id="advance-payment-source"
                            class="text-[10px] font-black text-[var(--text-main)] tracking-[0.2em]">TARJETA
                            REGISTRADA</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-3 relative z-10">
                <button onclick="confirmAdvancePayment()"
                    class="w-full relative group bg-brandPurple text-white py-5 rounded-2xl font-black uppercase text-[10px] tracking-[0.3em] shadow-2xl shadow-brandPurple/30 transition-all overflow-hidden flex items-center justify-center gap-3">
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000">
                    </div>
                    Confirmar Transacción <span class="material-symbols-outlined text-lg">lock</span>
                </button>
                <button onclick="closeAdvancePaymentModal()"
                    class="w-full py-5 bg-[var(--icon-bg)] text-[var(--text-muted)] rounded-2xl font-black uppercase text-[10px] tracking-[0.3em] hover:bg-brandPurple hover:text-white transition-all">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Gestionar Métodos de Pago -->
    <div id="managePaymentModal"
        class="hidden fixed inset-0 bg-[#0A0510]/80 backdrop-blur-xl z-[100] flex items-center justify-center p-6">
        <div
            class="bg-[var(--app-bg)] border border-[var(--card-border)] rounded-[2.5rem] p-8 max-w-md w-full shadow-2xl relative overflow-hidden">

            <div class="absolute -right-20 -top-20 w-40 h-40 bg-brandPurple/10 rounded-full blur-[80px]"></div>

            <div class="flex justify-between items-start mb-8 relative z-10">
                <div>
                    <h3 class="text-2xl font-black text-[var(--text-main)] italic tracking-tighter uppercase mb-1">
                        Métodos de Pago</h3>
                    <p class="text-[9px] font-black text-[var(--text-muted)] uppercase tracking-widest">Tus pasarelas
                        activas</p>
                </div>
                <button onclick="closeManagePaymentModal()"
                    class="w-10 h-10 bg-[var(--icon-bg)] border border-[var(--card-border)] rounded-xl flex items-center justify-center text-[var(--text-muted)] hover:text-red-400 hover:bg-red-500/10 transition-all">
                    <span class="material-symbols-outlined text-lg">close</span>
                </button>
            </div>

            <div id="savedCardsList" class="space-y-3 mb-8 relative z-10">
                <!-- Cards will be injected by JS -->
                <div id="dynamic-cards-container"></div>
            </div>

            <button onclick="showAddCardForm()" id="addCardBtn"
                class="w-full py-4 bg-[var(--icon-bg)] border border-dashed border-brandPurple/30 rounded-2xl text-[9px] font-black uppercase tracking-[0.3em] text-[var(--text-muted)] hover:text-brandPurple hover:border-brandPurple hover:bg-brandPurple/5 transition-all flex items-center justify-center gap-3 relative z-10">
                <span class="material-symbols-outlined text-lg">add_card</span> Añadir Tarjeta
            </button>

            <!-- Add Card Form -->
            <div id="addCardForm"
                class="hidden space-y-6 mt-6 p-6 bg-[var(--icon-bg)] rounded-[2rem] border border-[var(--card-border)] relative z-10 animate-fade-in">
                <div class="flex items-center gap-3 mb-4">
                    <span class="text-[9px] font-black text-brandPurple uppercase tracking-[0.4em]">Nueva Tarjeta</span>
                    <div class="flex-1 h-px bg-brandPurple/10"></div>
                </div>
                <div class="space-y-4">
                    <div class="space-y-1.5">
                        <label
                            class="text-[8px] font-black text-[var(--text-muted)] uppercase tracking-widest pl-1">Número</label>
                        <input type="text" id="newCardNumber" placeholder="0000 0000 0000 0000" maxlength="19"
                            class="w-full bg-[var(--app-bg)] border border-[var(--card-border)] rounded-xl py-3 px-4 text-xs font-black tracking-[0.2em] text-[var(--text-main)] outline-none focus:border-brandPurple transition-all">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1.5">
                            <label
                                class="text-[8px] font-black text-[var(--text-muted)] uppercase tracking-widest pl-1">MM/AA</label>
                            <input type="text" id="newCardExpiry" placeholder="MM/AA" maxlength="5"
                                class="w-full bg-[var(--app-bg)] border border-[var(--card-border)] rounded-xl py-3 px-4 text-xs font-black tracking-widest text-[var(--text-main)] outline-none focus:border-brandPurple transition-all">
                        </div>
                        <div class="space-y-1.5">
                            <label
                                class="text-[8px] font-black text-[var(--text-muted)] uppercase tracking-widest pl-1">CVV</label>
                            <input type="password" id="newCardCVV" placeholder="***" maxlength="3"
                                class="w-full bg-[var(--app-bg)] border border-[var(--card-border)] rounded-xl py-3 px-4 text-xs font-black tracking-widest text-[var(--text-main)] outline-none focus:border-brandPurple transition-all">
                        </div>
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="cancelAddCard()"
                        class="flex-1 py-4 bg-[var(--card-bg)] border border-[var(--card-border)] text-[var(--text-muted)] rounded-xl font-black uppercase text-[9px] tracking-widest hover:bg-white/10 transition-all">Cancelar</button>
                    <button onclick="saveNewCard()"
                        class="flex-2 px-6 py-4 bg-brandPurple text-white rounded-xl font-black uppercase text-[9px] tracking-widest hover:scale-[1.02] shadow-xl shadow-brandPurple/20 transition-all text-center">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <script>
        // Renewal Modal Logic
        function openRenewalModal() {
            document.getElementById('renewalModal').classList.remove('hidden');
        }

        function closeRenewalModal() {
            document.getElementById('renewalModal').classList.add('hidden');
        }

        // Modal logic
        function openAdvancePaymentModal() {
            document.getElementById('advancePaymentModal').classList.remove('hidden');
        }
        function closeAdvancePaymentModal() {
            document.getElementById('advancePaymentModal').classList.add('hidden');
        }

        function openManagePaymentModal() {
            document.getElementById('managePaymentModal').classList.remove('hidden');
            document.getElementById('addCardForm').classList.add('hidden');
            document.getElementById('addCardBtn').classList.remove('hidden');
        }
        function closeManagePaymentModal() {
            document.getElementById('managePaymentModal').classList.add('hidden');
        }

        function showAddCardForm() {
            document.getElementById('addCardForm').classList.remove('hidden');
            document.getElementById('addCardBtn').classList.add('hidden');
        }

        function cancelAddCard() {
            document.getElementById('addCardForm').classList.add('hidden');
            document.getElementById('addCardBtn').classList.remove('hidden');
            document.getElementById('newCardNumber').value = '';
            document.getElementById('newCardExpiry').value = '';
            document.getElementById('newCardCVV').value = '';
        }

        function saveNewCard() {
            const cardNumber = document.getElementById('newCardNumber').value;
            const expiry = document.getElementById('newCardExpiry').value;
            const cvv = document.getElementById('newCardCVV').value;

            if (!cardNumber || !expiry || !cvv) {
                alert('⚠️ Completa la información de seguridad.');
                return;
            }

            alert('✅ Pasarela añadida con éxito mediante BoxBot IA.');
            cancelAddCard();
            updateCardActionsState(); // Update state after adding a new card
        }

        function updateCardActionsState() {
            const cards = document.querySelectorAll('.method-card');
            cards.forEach(card => {
                const deleteBtn = card.querySelector('button[onclick^="deleteCard"]');
                if (deleteBtn) {
                    deleteBtn.style.display = cards.length <= 1 ? 'none' : 'flex';
                }
            });
        }

        function setPrimaryCard(cardId) {
            // Remove active styles from all cards
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('bg-[var(--card-bg)]', 'border-2', 'border-brandPurple', 'shadow-lg', 'shadow-brandPurple/5');
                card.classList.add('bg-[var(--icon-bg)]', 'border', 'border-[var(--card-border)]');

                // Reset status text
                const status = card.querySelector('.status-text');
                if (status) {
                    status.classList.remove('text-brandPurple');
                    status.classList.add('text-[var(--text-muted)]');
                    status.innerText = 'Secun. • 12/28'; // Simplificado para el demo
                }

                // Reset star button
                const starBtn = card.querySelector('.star-btn');
                if (starBtn) {
                    starBtn.classList.remove('bg-brandPurple/10', 'text-brandPurple');
                    starBtn.classList.add('bg-[var(--card-bg)]', 'border', 'border-[var(--card-border)]', 'text-[var(--text-muted)]');
                    starBtn.querySelector('.material-symbols-outlined').classList.remove('filled');
                }
            });

            // Set active styles to current card
            const activeCard = document.getElementById(`card-${cardId}`);
            if (activeCard) {
                activeCard.classList.remove('bg-[var(--icon-bg)]', 'border', 'border-[var(--card-border)]');
                activeCard.classList.add('bg-[var(--card-bg)]', 'border-2', 'border-brandPurple', 'shadow-lg', 'shadow-brandPurple/5');

                const status = activeCard.querySelector('.status-text');
                if (status) {
                    status.classList.remove('text-[var(--text-muted)]');
                    status.classList.add('text-brandPurple');
                    status.innerText = 'Principal • 12/28';
                }

                const starBtn = activeCard.querySelector('.star-btn');
                if (starBtn) {
                    starBtn.classList.remove('bg-[var(--card-bg)]', 'border', 'border-[var(--card-border)]', 'text-[var(--text-muted)]');
                    starBtn.classList.add('bg-brandPurple/10', 'text-brandPurple');
                    starBtn.querySelector('.material-symbols-outlined').classList.add('filled');
                }
            }
        }

        function deleteCard(cardId) {
            const cards = document.querySelectorAll('.method-card');
            if (cards.length <= 1) return;

            if (confirm('¿Eliminar este método de pago permanente?')) {
                const card = document.getElementById(`card-${cardId}`);
                if (card) {
                    const wasPrimary = card.classList.contains('border-brandPurple');

                    card.classList.add('scale-75', 'opacity-0');
                    setTimeout(() => {
                        card.remove();

                        // If we deleted the primary, assign a new one
                        if (wasPrimary) {
                            const nextCard = document.querySelector('.method-card');
                            if (nextCard) {
                                const nextId = nextCard.id.split('-')[1];
                                setPrimaryCard(nextId);
                            }
                        }
                        updateCardActionsState();
                    }, 300);
                }
            }
        }

        // Plan Expiry Logic
        function updatePlanExpiryStatus() {
            const expiryElement = document.getElementById('planExpiryDate');
            if (!expiryElement) return;

            const expiryDateStr = expiryElement.getAttribute('data-expiry');
            const expiryDate = new Date(expiryDateStr);
            const today = new Date();

            // Calculate difference in days
            const diffTime = expiryDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            expiryElement.classList.remove('text-slate-500', 'opacity-60', 'text-orange-500', 'text-red-500');

            if (diffDays <= 1) {
                expiryElement.classList.add('text-red-500');
            } else if (diffDays <= 10) {
                expiryElement.classList.add('text-orange-500');
            } else {
                expiryElement.classList.add('text-slate-500', 'opacity-60');
            }
        }

        // Initialize state
        document.addEventListener('DOMContentLoaded', () => {
            updateCardActionsState();
            updatePlanExpiryStatus();
        });
    </script>

    <!-- Mobile Nav -->
    <div
        class="md:hidden fixed bottom-8 left-6 right-6 bg-[var(--sidebar-bg)] backdrop-blur-3xl border border-[var(--card-border)] rounded-[2.5rem] p-3 shadow-2xl flex justify-between items-center z-50 nav-relative bottom-nav-pill">
        <div class="nav-indicator-mobile"></div>
        <button onclick="window.location.href='cliente_dashboard.html'"
            class="flex-1 flex flex-col items-center gap-1 py-1 text-[var(--text-muted)] hover:text-brandPurple transition-colors">
            <span class="material-symbols-outlined">home</span>
            <span class="text-[8px] font-black uppercase tracking-widest">Inicio</span>
        </button>
        <button onclick="window.location.href='cliente_inventario.html'"
            class="flex-1 flex flex-col items-center gap-1 py-1 text-[var(--text-muted)] hover:text-brandPurple transition-colors">
            <span class="material-symbols-outlined">inventory_2</span>
            <span class="text-[8px] font-black uppercase tracking-widest">Mi Espacio</span>
        </button>
        <div class="relative -top-10 z-20">
            <button onclick="window.location.href='../pages/reserva.html?from=pagos'"
                class="w-16 h-16 rounded-3xl bg-brandPurple text-white shadow-2xl shadow-brandPurple/40 flex items-center justify-center transform hover:scale-110 active:scale-90 transition-all border-4 border-[var(--app-bg)]">
                <span class="material-symbols-outlined text-2xl">add</span>
            </button>
        </div>
        <button onclick="window.location.href='cliente_pagos.html'"
            class="nav-item-pill-active flex-1 flex flex-col items-center gap-1 py-1 transition-all">
            <span class="material-symbols-outlined filled">receipt_long</span>
            <span class="text-[8px] font-black uppercase tracking-widest">Pagos</span>
        </button>
        <button onclick="window.location.href='cliente_cuenta.html'"
            class="flex-1 flex flex-col items-center gap-1 py-1 text-[var(--text-muted)] hover:text-brandPurple transition-colors">
            <span class="material-symbols-outlined">settings</span>
            <span class="text-[8px] font-black uppercase tracking-widest">Cuenta</span>
        </button>
    </div>

    <!-- Supabase Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/js/supabase-config.js"></script>
    <script src="../assets/js/supabase-client.js"></script>
    <script src="../assets/js/cliente-pagos.js"></script>

    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/chat.js"></script>
</body>

</html>