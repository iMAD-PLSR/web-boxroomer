<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes | BOXROOMER Admin</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../assets/js/tailwind.config.js"></script>

    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-brandDark text-white h-screen overflow-hidden flex">

    <!-- Sidebar -->
    <aside class="w-64 bg-[#111] border-r border-white/5 flex flex-col justify-between p-6">
        <div>
            <div class="flex items-center gap-3 mb-10 opacity-80 hover:opacity-100 transition-opacity cursor-pointer">
                <img src="../assets/images/logo.png" alt="LOGO" class="h-6 brightness-0 invert">
                <span
                    class="bg-brandPurple text-white text-[9px] font-black px-1.5 py-0.5 rounded uppercase tracking-widest">Admin</span>
            </div>

            <nav class="space-y-2">
                <a href="admin_dashboard.html"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all">
                    <span class="material-symbols-outlined">space_dashboard</span>
                    <span class="text-xs font-bold uppercase tracking-wider">Dashboard</span>
                </a>
                <a href="admin_clientes.html"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl bg-brandPurple text-white border border-brandPurple/20 shadow-lg shadow-brandPurple/10 transition-all">
                    <span class="material-symbols-outlined">group</span>
                    <span class="text-xs font-bold uppercase tracking-wider">Clientes</span>
                </a>
                <a href="admin_logistica.html"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all">
                    <span class="material-symbols-outlined">inventory_2</span>
                    <span class="text-xs font-bold uppercase tracking-wider">Log√≠stica</span>
                </a>
                <a href="admin_facturacion.html"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all">
                    <span class="material-symbols-outlined">payments</span>
                    <span class="text-xs font-bold uppercase tracking-wider">Facturaci√≥n</span>
                </a>
                <a href="admin_ajustes.html"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all">
                    <span class="material-symbols-outlined">settings</span>
                    <span class="text-xs font-bold uppercase tracking-wider">Ajustes</span>
                </a>
            </nav>
        </div>

        <div class="px-4 py-3 bg-brandPurple/10 rounded-xl border border-brandPurple/20">
            <p class="text-[10px] text-brandPurple font-black uppercase tracking-widest mb-1">Superadmin</p>
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-xs font-bold text-white">Israel Madrigal</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto bg-[#0a0a0a] p-8">

        <header class="flex justify-between items-end mb-10">
            <div>
                <h1 class="text-3xl font-black tracking-tight">Base de Clientes</h1>
                <p class="text-slate-400 text-sm font-medium mt-1">Gesti√≥n integral de usuarios y contratos activos</p>
            </div>

            <!-- Search Bar -->
            <div class="relative w-96">
                <span
                    class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-xl">search</span>
                <input type="text" placeholder="Buscar por nombre, email o DNI..."
                    class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 pl-12 pr-4 text-sm text-white focus:border-brandPurple outline-none transition-all">
            </div>
        </header>

        <!-- Filters -->
        <div class="flex gap-2 p-1 bg-white/5 rounded-2xl border border-white/5">
            <button onclick="setFilter('TODOS', this)"
                class="filter-btn px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all bg-white text-brandDark shadow-lg">Todos</button>
            <button onclick="setFilter('ACTIVOS', this)"
                class="filter-btn px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white transition-all">Activos</button>
            <button onclick="setFilter('IMPAGOS', this)"
                class="filter-btn px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white transition-all">Impagos</button>
            <button onclick="setFilter('PENDIENTE_LLAMADA', this)"
                class="filter-btn px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white transition-all">P.
                Llamada</button>
            <button onclick="setFilter('INACTIVOS', this)"
                class="filter-btn px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white transition-all">Inactivos</button>
            <button onclick="setFilter('CANCELADO', this)"
                class="filter-btn px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white transition-all">Cancelados</button>
        </div>

        <!-- Clients Table -->
        <div class="bg-[#141414] border border-white/5 rounded-2xl overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-white/5 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                        <th class="p-4">Usuario</th>
                        <th class="p-4">DNI / ID</th>
                        <th class="p-4">Plan / Volumen</th>
                        <th class="p-4">Permanencia</th>
                        <th class="p-4">Estado</th>
                        <th class="p-4 text-right">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-sm font-medium text-slate-300 divide-y divide-white/5" id="clients-table-body">
                    <!-- Javascript populates -->
                </tbody>
            </table>
        </div>

    </main>

    <!-- Client Detail Modal -->
    <div id="clientModal"
        class="fixed inset-0 bg-black/90 backdrop-blur-md z-[100] hidden items-center justify-center p-4">
        <div
            class="bg-[#1a1a1a] border border-white/10 w-full max-w-4xl rounded-[3rem] overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">

            <!-- Header Modal -->
            <div
                class="p-8 bg-gradient-to-r from-brandPurple/20 to-blue-600/20 border-b border-white/10 relative shrink-0">
                <button onclick="closeClientModal()"
                    class="absolute right-6 top-6 w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-slate-400 hover:text-white transition-all">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="flex items-center gap-6">
                    <div id="modal-avatar"
                        class="w-20 h-20 rounded-[1.5rem] bg-brandPurple text-white flex items-center justify-center text-3xl font-black italic shadow-xl shadow-brandPurple/20">
                        IM</div>
                    <div>
                        <div class="flex items-center gap-3">
                            <h2 id="modal-name"
                                class="text-3xl font-black text-white italic uppercase tracking-tighter">Israel Madrigal
                            </h2>
                            <span id="modal-status-badge"
                                class="bg-green-500/10 text-green-500 text-[9px] font-black px-2 py-1 rounded uppercase tracking-[0.2em] border border-green-500/20">Activo</span>
                        </div>
                        <p id="modal-email" class="text-slate-400 font-bold mt-1">israel@ejemplo.com</p>
                    </div>
                </div>

                <!-- Tabs Selector -->
                <div class="flex gap-8 mt-10">
                    <button onclick="switchTab('info')"
                        class="tab-btn active text-[10px] font-black uppercase tracking-[0.2em] pb-2 border-b-2 border-brandPurple text-white transition-all">Informaci√≥n
                        360¬∫</button>
                    <button onclick="switchTab('history')"
                        class="tab-btn text-[10px] font-black uppercase tracking-[0.2em] pb-2 border-b-2 border-transparent text-slate-500 hover:text-white transition-all">Hist√≥rico
                        Actividad</button>
                    <button onclick="switchTab('billing')"
                        class="tab-btn text-[10px] font-black uppercase tracking-[0.2em] pb-2 border-b-2 border-transparent text-slate-500 hover:text-white transition-all">Facturas
                        y Pagos</button>
                </div>
            </div>

            <div class="p-8 overflow-y-auto flex-1 scrollbar-hide">
                <!-- Tab: Information -->
                <div id="tab-info" class="tab-content space-y-10">
                    <div class="grid grid-cols-2 gap-10">
                        <div class="space-y-6">
                            <div>
                                <p class="text-[9px] font-black uppercase text-slate-500 mb-2 tracking-widest px-1">
                                    Datos de Facturaci√≥n</p>
                                <div class="bg-white/[0.03] border border-white/10 rounded-2xl p-5 space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-[10px] font-bold text-slate-400 uppercase">DNI / CIF</span>
                                        <span id="modal-dni" class="text-sm font-black text-white">51234567-Z</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-[10px] font-bold text-slate-400 uppercase">Raz√≥n Social</span>
                                        <span id="modal-company" class="text-sm font-black text-white">Personal</span>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <span class="text-[10px] font-bold text-slate-400 uppercase">Direcci√≥n
                                            Fiscal</span>
                                        <span id="modal-address" class="text-xs font-medium text-slate-300">C/ Gran V√≠a
                                            12, 28013 Madrid</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <p class="text-[9px] font-black uppercase text-slate-500 mb-2 tracking-widest px-1">Plan
                                    Contratado</p>
                                <div
                                    class="bg-brandPurple/5 border border-brandPurple/20 rounded-2xl p-5 flex items-center justify-between">
                                    <div>
                                        <h4 id="modal-plan"
                                            class="text-lg font-black text-white uppercase italic tracking-tighter">Pack
                                            D√∫o</h4>
                                        <p id="modal-volume"
                                            class="text-[10px] text-brandPurple font-black uppercase tracking-widest">
                                            3.5 m¬≥ ‚Ä¢ Permanencia 6 meses</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-black text-white">49‚Ç¨<span
                                                class="text-xs text-slate-500 font-bold tracking-normal italic">/mes</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <p class="text-[9px] font-black uppercase text-slate-500 mb-2 tracking-widest px-1">
                                    Acciones R√°pidas</p>
                                <div class="grid grid-cols-1 gap-3">
                                    <button onclick="openChargeModal()"
                                        class="group flex items-center gap-4 bg-white/5 border border-white/10 p-4 rounded-2xl hover:bg-brandPurple transition-all">
                                        <div
                                            class="w-10 h-10 rounded-xl bg-brandPurple/10 group-hover:bg-white/20 flex items-center justify-center">
                                            <span
                                                class="material-symbols-outlined text-brandPurple group-hover:text-white">add_card</span>
                                        </div>
                                        <div class="text-left">
                                            <p class="text-[10px] font-black text-white uppercase tracking-widest">
                                                Emitir Cargo Manual</p>
                                            <p
                                                class="text-[8px] text-slate-500 group-hover:text-white/60 font-bold uppercase">
                                                Extras, mozos o km</p>
                                        </div>
                                    </button>

                                    <div class="bg-white/5 border border-white/10 p-4 rounded-2xl">
                                        <p class="text-[9px] font-black uppercase text-slate-500 mb-3 tracking-widest">
                                            Cambiar Estado Manual</p>
                                        <select onchange="handleStatusChange(this.value)" id="modal-status-select"
                                            class="w-full bg-[#1A1A1A] text-[10px] font-black uppercase tracking-tighter border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-brandPurple transition-all appearance-none cursor-pointer">
                                            <option value="ACTIVOS">Cambiar a Activo</option>
                                            <option value="IMPAGOS">Reportar Impago</option>
                                            <option value="PENDIENTE_LLAMADA">Pendiente Llamada</option>
                                            <option value="CANCELADO">Cancelar Servicio</option>
                                            <option value="INACTIVOS">Archivar (Inactivo)</option>
                                        </select>
                                    </div>

                                    <button onclick="notifyClient()"
                                        class="group flex items-center gap-4 bg-white/5 border border-white/10 p-4 rounded-2xl hover:bg-blue-600 transition-all">
                                        <div
                                            class="w-10 h-10 rounded-xl bg-blue-600/10 group-hover:bg-white/20 flex items-center justify-center">
                                            <span
                                                class="material-symbols-outlined text-blue-500 group-hover:text-white">send</span>
                                        </div>
                                        <div class="text-left">
                                            <p class="text-[10px] font-black text-white uppercase tracking-widest">
                                                Notificar al Cliente</p>
                                            <p
                                                class="text-[8px] text-slate-500 group-hover:text-white/60 font-bold uppercase">
                                                Email o WhatsApp</p>
                                        </div>
                                    </button>
                                </div>
                            </div>
                            <div class="bg-[#111] p-5 rounded-3xl border border-white/5 relative overflow-hidden">
                                <span
                                    class="material-symbols-outlined absolute -right-4 -bottom-4 text-7xl opacity-5">gavel</span>
                                <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3">
                                    Contrato Digital</h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-bold text-white flex items-center gap-2">
                                        <span class="material-symbols-outlined text-green-500 text-sm">verified</span>
                                        Firmado via IP
                                    </span>
                                    <button
                                        class="text-brandPurple text-[10px] font-black uppercase tracking-widest underline decoration-brandPurple/30">Descargar
                                        PDF</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: History -->
                <div id="tab-history" class="tab-content hidden space-y-4">
                    <div class="space-y-3" id="history-list">
                        <!-- History Items -->
                        <div class="flex gap-4 p-4 rounded-2xl bg-white/[0.02] border border-white/5">
                            <div class="w-2 h-2 rounded-full bg-brandPurple mt-1.5 shrink-0"></div>
                            <div>
                                <p class="text-xs font-black text-white uppercase italic tracking-widest">Contrato
                                    Activado</p>
                                <p class="text-[9px] text-slate-500 font-bold uppercase mt-1">14 Ene 2026 ‚Ä¢ 15:42 ‚Ä¢
                                    Admin: SI</p>
                            </div>
                        </div>
                        <div class="flex gap-4 p-4 rounded-2xl bg-white/[0.02] border border-white/5">
                            <div class="w-2 h-2 rounded-full bg-blue-500 mt-1.5 shrink-0"></div>
                            <div>
                                <p class="text-xs font-black text-white uppercase italic tracking-widest">Recogida
                                    Programada</p>
                                <p class="text-[9px] text-slate-500 font-bold uppercase mt-1">14 Ene 2026 ‚Ä¢ 11:20 ‚Ä¢
                                    Cliente: WEB</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Billing -->
                <div id="tab-billing" class="tab-content hidden">
                    <div class="bg-[#111] rounded-2xl border border-white/5 overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-white/5">
                                <tr class="text-[9px] font-black text-slate-500 uppercase tracking-widest">
                                    <th class="p-4">N¬∫ Factura</th>
                                    <th class="p-4">Fecha</th>
                                    <th class="p-4">Concepto</th>
                                    <th class="p-4">Importe</th>
                                    <th class="p-4">Estado</th>
                                    <th class="p-4 text-right">PDF</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5 text-[11px] font-bold text-slate-300">
                                <tr>
                                    <td class="p-4">FACT-2026-001</td>
                                    <td class="p-4">14/01/2026</td>
                                    <td class="p-4 uppercase">Reserva y Gesti√≥n</td>
                                    <td class="p-4 text-white font-black">39.00‚Ç¨</td>
                                    <td class="p-4"><span
                                            class="bg-green-500/10 text-green-500 px-2 py-0.5 rounded text-[8px] font-black uppercase">Pagado</span>
                                    </td>
                                    <td class="p-4 text-right"><span
                                            class="material-symbols-outlined text-sm cursor-pointer hover:text-brandPurple">download</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Charge Modal -->
    <div id="chargeModal"
        class="fixed inset-0 bg-black/95 backdrop-blur-xl z-[200] hidden items-center justify-center p-4">
        <div class="bg-[#1a1a1a] border border-white/10 w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="text-xl font-black mb-6 uppercase tracking-tight flex items-center gap-3">
                <span class="material-symbols-outlined text-brandPurple">add_card</span>
                Emitir Cargo Manual
            </h3>
            <div class="space-y-6">
                <div>
                    <label class="text-[9px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Importe
                        (‚Ç¨)</label>
                    <input type="number" step="0.01" placeholder="00.00"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-5 text-xl font-black text-white outline-none focus:border-brandPurple transition-all">
                </div>
                <div>
                    <label class="text-[9px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Concepto
                        del Cargo</label>
                    <select
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-5 text-sm font-bold text-white outline-none focus:border-brandPurple appearance-none">
                        <option value="km" class="bg-[#1a1a1a]">üöô Kilometraje Extra</option>
                        <option value="mozo" class="bg-[#1a1a1a]">üë®‚Äçüîß Mozo Adicional</option>
                        <option value="cajas" class="bg-[#1a1a1a]">üì¶ Cajas Extra</option>
                        <option value="cancelacion" class="bg-[#1a1a1a]">‚ùå Gastos de Cancelaci√≥n</option>
                        <option value="otros" class="bg-[#1a1a1a]">‚ú® Otros Conceptos</option>
                    </select>
                </div>
                <div>
                    <label
                        class="text-[9px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Observaciones
                        (Opcional)</label>
                    <textarea
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-5 text-xs font-medium text-white outline-none focus:border-brandPurple h-20"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button onclick="closeChargeModal()"
                    class="flex-1 py-4 rounded-xl bg-white/5 text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition-all">Volver</button>
                <button onclick="executeCharge()"
                    class="flex-1 py-4 rounded-xl bg-brandPurple text-white text-[10px] font-black uppercase tracking-widest shadow-lg shadow-brandPurple/20 hover:scale-105 transition-all">Ejecutar
                    Cobro</button>
            </div>
        </div>
    </div>

    <script>
        let allClients = [];
        let currentFilter = 'TODOS';

        document.addEventListener('DOMContentLoaded', () => {
            loadClientsData();
            setupSearch();
            renderClients();
        });

        function loadClientsData() {
            // Simulated database
            allClients = [
                { id: 'RE1022', name: 'Ana Garc√≠a', email: 'ana.garcia@gmail.com', dni: '51239922Z', company: 'Personal', status: 'ACTIVOS', plan: 'Pack Mini', volume: '1.0', months: 12, address: 'C/ Vel√°zquez 45, Madrid', active: true },
                { id: 'RE3341', name: 'Roberto Sanchidri√°n', email: 'roberto@enterprise.es', dni: 'B-12345678', company: 'Logistics S.L.', status: 'IMPAGOS', plan: 'Personalizado', volume: '12.5', months: 6, address: 'Pol. Ind. Cobo Calleja', active: true },
                { id: 'RE8821', name: 'Sergio Mart√≠n', email: 's.martin@outlook.com', dni: '05442112K', company: 'Personal', status: 'INACTIVOS', plan: 'Pack D√∫o', volume: '3.0', months: 3, address: 'Av. Am√©rica 4', active: false }
            ];

            const localData = localStorage.getItem('BOXROOMER_DASHBOARD_DATA');
            if (localData) {
                const data = JSON.parse(localData);
                allClients.unshift({
                    id: 'RE-NEW',
                    name: data.userName || 'Usuario Nuevo',
                    email: data.userEmail || 'email@ejemplo.com',
                    dni: 'PENDIENTE',
                    company: 'Pendiente',
                    status: (data.status === 'pending_pickup') ? 'PENDIENTE_LLAMADA' : 'ACTIVOS',
                    plan: data.plan || 'Plan Web',
                    volume: data.volume || '0',
                    months: 6,
                    address: data.address || 'Pendiente confirmar',
                    active: true
                });
            }
        }

        function setupSearch() {
            const searchInput = document.querySelector('input[type="text"]');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                renderClients(query);
            });
        }

        function setFilter(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('bg-white', 'text-brandDark', 'shadow-lg');
                b.classList.add('text-slate-400');
            });
            btn.classList.add('bg-white', 'text-brandDark', 'shadow-lg');
            btn.classList.remove('text-slate-400', 'hover:text-white');
            renderClients();
        }

        function renderClients(searchQuery = '') {
            const tableBody = document.getElementById('clients-table-body');
            let filtered = allClients;

            // Apply Status Filter
            if (currentFilter !== 'TODOS') {
                filtered = filtered.filter(c => c.status === currentFilter);
            }

            // Apply Search Query
            if (searchQuery) {
                filtered = filtered.filter(c =>
                    c.name.toLowerCase().includes(searchQuery) ||
                    c.email.toLowerCase().includes(searchQuery) ||
                    c.dni.toLowerCase().includes(searchQuery) ||
                    c.id.toLowerCase().includes(searchQuery)
                );
            }

            tableBody.innerHTML = filtered.map(c => `
                <tr class="hover:bg-white/[0.03] transition-colors group">
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-brandPurple to-blue-600 text-white flex items-center justify-center font-black text-xs italic">
                                ${c.name.charAt(0)}
                            </div>
                            <div>
                                <p class="text-white font-bold group-hover:text-brandPurple transition-colors">${c.name}</p>
                                <p class="text-[10px] text-slate-500">${c.email}</p>
                            </div>
                        </div>
                    </td>
                    <td class="p-4 text-[11px] font-bold text-slate-400 font-mono italic">${c.dni} <span class="block opacity-40 text-[9px] font-sans">#${c.id}</span></td>
                    <td class="p-4">
                        <span class="block text-white font-black italic uppercase text-[10px]">${c.plan}</span>
                        <span class="text-[10px] text-slate-500 font-bold uppercase">${c.volume} m¬≥</span>
                    </td>
                    <td class="p-4 text-xs font-bold text-slate-400 uppercase tracking-widest">${c.months} Meses</td>
                    <td class="p-4">
                        ${getStatusBadge(c.status)}
                    </td>
                    <td class="p-4 text-right">
                        <button onclick="openClientDetail('${c.id}')" class="w-9 h-9 rounded-xl bg-white/5 border border-white/10 text-slate-500 hover:bg-brandPurple hover:text-white transition-all">
                            <span class="material-symbols-outlined text-lg">visibility</span>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusBadge(status) {
            const styles = {
                'ACTIVOS': 'bg-green-500/10 text-green-500 border-green-500/20',
                'IMPAGOS': 'bg-red-500/10 text-red-500 border-red-500/20',
                'INACTIVOS': 'bg-white/5 text-slate-500 border-white/10',
                'PENDIENTE_LLAMADA': 'bg-orange-500/10 text-orange-400 border-orange-500/20',
                'CANCELADO': 'bg-red-500/20 text-red-400 border-red-500/30'
            };
            const labels = {
                'ACTIVOS': 'Activo',
                'IMPAGOS': 'Impago',
                'INACTIVOS': 'Inactivo',
                'PENDIENTE_LLAMADA': 'P. Llamada',
                'CANCELADO': 'Cancelado'
            };
            return `<span class="px-2 py-1 rounded-[6px] text-[8px] font-black uppercase tracking-widest border ${styles[status]}">${labels[status]}</span>`;
        }

        function handleStatusChange(newStatus) {
            const client = allClients.find(c => c.id === currentClientId);
            if (client) {
                client.status = newStatus;
                renderClients();
                document.getElementById('modal-status-badge').innerHTML = getStatusBadge(newStatus);
            }

            if (newStatus === 'CANCELADO') {
                const confirmCancel = confirm("¬øEst√°s seguro de que deseas cancelar este servicio? El sistema sugerir√° cobrar los gastos de gesti√≥n (39‚Ç¨).");
                if (confirmCancel) {
                    openChargeModal();
                    document.querySelector('#chargeModal input[type="number"]').value = 39;
                    document.querySelector('#chargeModal input[type="text"]').value = "Gastos de Gesti√≥n y Cancelaci√≥n";
                    document.querySelector('#chargeModal textarea').value = "Cobro autom√°tico sugerido por cambio de estado a CANCELADO.";
                }
            }
        }


        // Modal Logic
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active', 'text-white', 'border-brandPurple');
                b.classList.add('text-slate-500', 'border-transparent');
            });

            document.getElementById('tab-' + tabId).classList.remove('hidden');
            const activeBtn = Array.from(document.querySelectorAll('.tab-btn')).find(b => b.innerText.toLowerCase().includes(tabId === 'info' ? '360' : tabId === 'history' ? 'hist√≥rico' : 'facturas'));
            if (activeBtn) {
                activeBtn.classList.add('active', 'text-white', 'border-brandPurple');
                activeBtn.classList.remove('text-slate-500', 'border-transparent');
            }
        }

        let currentClientId = null;

        function openClientDetail(id) {
            currentClientId = id;
            const c = allClients.find(client => client.id === id);
            if (!c) return;

            document.getElementById('modal-name').innerText = c.name;
            document.getElementById('modal-email').innerText = c.email;
            document.getElementById('modal-dni').innerText = c.dni;
            document.getElementById('modal-company').innerText = c.company;
            document.getElementById('modal-address').innerText = c.address;
            document.getElementById('modal-plan').innerText = c.plan;
            document.getElementById('modal-volume').innerText = `${c.volume} m¬≥ ‚Ä¢ Permanencia ${c.months} meses`;
            document.getElementById('modal-avatar').innerText = c.name.charAt(0);
            document.getElementById('modal-status-select').value = c.status;

            const badge = document.getElementById('modal-status-badge');
            badge.innerText = c.status.replace('_', ' ');

            const modal = document.getElementById('clientModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            switchTab('info');
        }

        function closeClientModal() {
            document.getElementById('clientModal').classList.add('hidden');
            document.getElementById('clientModal').classList.remove('flex');
        }

        function openChargeModal() {
            document.getElementById('chargeModal').classList.remove('hidden');
            document.getElementById('chargeModal').classList.add('flex');
        }

        function closeChargeModal() {
            document.getElementById('chargeModal').classList.add('hidden');
            document.getElementById('chargeModal').classList.remove('flex');
        }

        function executeCharge() {
            const amountInput = document.querySelector('#chargeModal input[type="number"]');
            const conceptInput = document.querySelector('#chargeModal input[type="text"]');
            const amount = parseFloat(amountInput.value);

            if (isNaN(amount) || amount <= 0) {
                alert('‚ö†Ô∏è El importe del cargo debe ser mayor a 0‚Ç¨');
                return;
            }

            const btn = document.querySelector('#chargeModal button:last-child');
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin text-sm">sync</span> Procesando...';
            btn.disabled = true;

            setTimeout(() => {
                btn.innerText = 'Cobro Completado';
                btn.classList.replace('bg-brandPurple', 'bg-green-500');

                // Add to Audit Log
                addAuditLog('CARGO_MANUAL', `Cobro de ${amount}‚Ç¨ por concepto: ${conceptInput.value}`, 'ALTA', currentClientId, 'CLIENTES');

                setTimeout(() => {
                    closeChargeModal();
                    alert('‚úÖ Cargo procesado a trav√©s de Stripe y factura generada.');
                    btn.innerText = 'Ejecutar Cobro';
                    btn.classList.replace('bg-green-500', 'bg-brandPurple');
                    btn.disabled = false;
                }, 1000);
            }, 1500);
        }

        function notifyClient() {
            const client = allClients.find(c => c.id === currentClientId);
            if (!client) return;

            const mode = confirm("¬øDeseas notificar v√≠a WhatsApp?\n(Si cancelas, se abrir√° el gestor de correo)");

            const message = `Hola ${client.name}, te contactamos desde BOXROOMER. Tu servicio est√° listo. Puedes ver m√°s detalles en tu √°rea privada. ¬°Saludos!`;

            if (mode) {
                // WhatsApp Simulation (assuming a phone field or dummy)
                const phone = "34600000000"; // Dummy
                window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
                addAuditLog('NOTIF_WHATSAPP', 'Notificaci√≥n enviada v√≠a WhatsApp', 'INFO', currentClientId, 'CLIENTES');
            } else {
                const subject = "Actualizaci√≥n de tu servicio BOXROOMER";
                const body = `Estimado/a ${client.name},\n\nLe contactamos para informarle sobre el estado de su servicio...\n\nAtentamente,\nEquipo BOXROOMER\ncorreo@boxroomer.com`;
                window.location.href = `mailto:${client.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                addAuditLog('NOTIF_EMAIL', 'Notificaci√≥n enviada v√≠a Email', 'INFO', currentClientId, 'CLIENTES');
            }
        }

        function addAuditLog(action, details, level, target, origin) {
            const logs = JSON.parse(localStorage.getItem('BOXROOMER_AUDIT_LOG') || '[]');
            logs.unshift({
                timestamp: new Date().toISOString(),
                action,
                details,
                level,
                target,
                origin,
                admin: 'Admin Principal'
            });
            localStorage.setItem('BOXROOMER_AUDIT_LOG', JSON.stringify(logs.slice(0, 100)));
        }
    </script>
</body>

</html>
</body>

</html>