<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crear Cuenta | BOXROOMER</title>

    <!-- Icons & Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../assets/js/tailwind.config.js"></script>

    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }
    </style>
</head>

<body
    class="bg-[#0A0510] text-white min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">

    <!-- Background Decor (Premium Blobs) -->
    <div
        class="absolute -top-40 -left-40 w-[600px] h-[600px] bg-brandPurple/20 rounded-full blur-[120px] animate-pulse">
    </div>
    <div class="absolute -bottom-40 -right-40 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[100px]"></div>
    <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-[0.03] pointer-events-none">
    </div>

    <!-- Card Container -->
    <div
        class="bg-white/[0.03] backdrop-blur-2xl border border-white/10 w-full max-w-sm p-10 rounded-[3rem] shadow-[0_32px_64px_-16px_rgba(0,0,0,0.5)] relative z-10 my-10">

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-black text-white tracking-tighter italic uppercase">Empieza <span
                    class="text-brandPurple underline decoration-brandPurple/30">Hoy</span></h1>
            <p class="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em] mt-2">Ãšnete a tu Trastero
                Inteligente</p>
        </div>

        <!-- Form -->
        <form onsubmit="handleRegister(event)" class="space-y-4">

            <!-- Name Input -->
            <div class="space-y-2">
                <label class="text-[10px] uppercase font-black tracking-widest text-brandPurple/80 pl-4">Tu
                    Nombre</label>
                <div class="relative group">
                    <span
                        class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-lg group-focus-within:text-brandPurple transition-colors">badge</span>
                    <input type="text" placeholder="Â¿CÃ³mo te llamas?" required id="reg-name" autocomplete="name"
                        class="w-full bg-white/[0.03] border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-sm font-bold outline-none focus:border-brandPurple focus:bg-white/5 transition-all text-white placeholder:text-slate-600">
                </div>
            </div>

            <!-- Email Input -->
            <div class="space-y-2">
                <label class="text-[10px] uppercase font-black tracking-widest text-brandPurple/80 pl-4">Email</label>
                <div class="relative group">
                    <span
                        class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-lg group-focus-within:text-brandPurple transition-colors">mail</span>
                    <input type="email" placeholder="tu@email.com" required autocomplete="email"
                        class="w-full bg-white/[0.03] border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-sm font-bold outline-none focus:border-brandPurple focus:bg-white/5 transition-all text-white placeholder:text-slate-600">
                </div>
            </div>

            <!-- Password Input -->
            <div class="space-y-2">
                <label class="text-[10px] uppercase font-black tracking-widest text-brandPurple/80 pl-4">Crea una
                    ContraseÃ±a</label>
                <div class="relative group">
                    <span
                        class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-lg group-focus-within:text-brandPurple transition-colors">lock</span>
                    <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="8" autocomplete="new-password"
                        class="w-full bg-white/[0.03] border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-sm font-bold outline-none focus:border-brandPurple focus:bg-white/5 transition-all text-white placeholder:text-slate-600">
                </div>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest pl-4 mt-1 italic">MÃ­nimo 8
                    caracteres</p>
            </div>

            <!-- Terms Checkbox -->
            <div class="flex items-start gap-4 px-2 py-2">
                <input type="checkbox" id="terms" required
                    class="mt-1 w-4 h-4 rounded border-white/10 bg-white/5 text-brandPurple focus:ring-brandPurple">
                <label for="terms" class="text-[9px] text-slate-500 font-black uppercase tracking-widest leading-tight">
                    Acepto los <a href="condiciones.html" class="font-bold underline text-brandPurple">TÃ©rminos</a> y la
                    <a href="privacidad.html" class="font-bold underline text-brandPurple">Privacidad</a>.
                </label>
            </div>

            <!-- Submit Button -->
            <button type="submit"
                class="w-full group relative bg-brandPurple text-white py-4 rounded-2xl font-black uppercase text-xs tracking-[0.2em] shadow-xl shadow-brandPurple/20 hover:scale-[1.02] hover:shadow-2xl active:scale-[0.98] transition-all flex items-center justify-center gap-2 mt-2 overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000">
                </div>
                <span class="relative">Crear Mi Espacio</span>
                <span class="material-symbols-outlined text-sm relative">rocket_launch</span>
            </button>

        </form>

        <!-- Divider -->
        <div class="relative flex py-6 items-center">
            <div class="flex-grow border-t border-white/5"></div>
            <span class="flex-shrink mx-4 text-white/20 text-[9px] font-black uppercase tracking-widest">O con</span>
            <div class="flex-grow border-t border-white/5"></div>
        </div>

        <!-- Social Login Grid -->
        <div class="grid grid-cols-1 gap-4">
            <button type="button" onclick="handleGoogleLogin()"
                class="bg-white/[0.02] border border-white/10 text-white py-3 rounded-2xl font-bold text-[10px] flex items-center justify-center gap-2 hover:bg-white/[0.05] transition-all w-full">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" class="w-4 h-4">
                    <path fill="#FFC107"
                        d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.697-6.101,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z">
                    </path>
                    <path fill="#FF3D00"
                        d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z">
                    </path>
                    <path fill="#4CAF50"
                        d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z">
                    </path>
                    <path fill="#1976D2"
                        d="M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.251-2.22,4.147-4.011,5.488l6.19,5.238C37.483,38.72,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z">
                    </path>
                </svg>
                Google
            </button>
        </div>

        <!-- Login Link -->
        <div class="text-center mt-8">
            <p class="text-xs font-medium text-slate-500">Â¿Ya tienes cuenta? <a href="login.html"
                    class="text-brandPurple font-black hover:underline uppercase tracking-tighter ml-1">Inicia
                    SesiÃ³n</a></p>
        </div>

    </div>

    <!-- Back to Home -->
    <a href="../index.html"
        class="absolute bottom-8 text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] hover:text-brandPurple transition-colors flex items-center gap-2">
        <span class="material-symbols-outlined text-sm">west</span> Volver al inicio
    </a>

    <!-- Supabase SDK & Config -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/js/supabase-config.js"></script>
    <script src="../assets/js/supabase-client.js"></script>

    <script>
        async function handleGoogleLogin() {
            if (!window.supabaseClient) {
                alert("Error: Supabase no inicializado");
                return;
            }
            try {
                const { error } = await window.supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent',
                        },
                        redirectTo: window.location.origin + '/pages/cliente_dashboard.html'
                    }
                });
                if (error) throw error;
            } catch (error) {
                console.error("Google Login Error:", error);
                alert("Error al iniciar sesiÃ³n con Google");
            }
        }

        async function handleRegister(e) {
            e.preventDefault();

            const nameInput = document.getElementById('reg-name');
            const emailInput = e.target.querySelector('input[type="email"]');
            const passwordInput = e.target.querySelector('input[type="password"]');

            const name = nameInput.value;
            const email = emailInput.value.toLowerCase().trim();
            const password = passwordInput.value;

            // Loading UI
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin text-lg">sync</span> <span class="ml-2 italic uppercase tracking-widest text-[10px] font-black">Registrando...</span>';

            // 1. SUPABASE REAL REGISTER (If Configured)
            if (window.supabaseClient) {
                console.log("ðŸš€ [Auth] Attempting real Supabase Registration...");
                try {
                    const { data, error } = await window.supabaseClient.auth.signUp({
                        email,
                        password,
                        options: {
                            data: {
                                full_name: name
                            }
                        }
                    });

                    if (error) throw error;

                    // Note: Profile is created by DB Trigger (handle_new_user)
                    // We can redirect to a "Verify Email" or directly to dashboard
                    alert("Â¡Registro completado! Por favor, revisa tu email para confirmar la cuenta.");
                    window.location.href = 'login.html';
                    return;

                } catch (err) {
                    console.error("âŒ Registration Error:", err);
                    alert("Error al registrarte: " + (err.message || "IntÃ©ntalo de nuevo"));
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    return;
                }
            }

            // 2. MOCK DATA FALLBACK
            console.warn("ðŸ›¡ï¸ [Auth] Demo Mode: Falling back to Local Simulation.");
            setTimeout(() => {
                const dashboardData = {
                    userName: name.split(' ')[0],
                    volume: 0,
                    address: "Por definir",
                    status: 'active',
                    pickupDate: '-',
                    pickupTime: '-',
                    plan: 'Cuenta Nueva'
                };
                if (!localStorage.getItem('BOXROOMER_DASHBOARD_DATA')) {
                    localStorage.setItem('BOXROOMER_DASHBOARD_DATA', JSON.stringify(dashboardData));
                }
                window.location.href = 'cliente_dashboard.html';
            }, 2000);
        }
    </script>

</body>

</html>